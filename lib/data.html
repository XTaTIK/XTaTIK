package Fake;
use utf8;
1;
__DATA__

@@ index.html.ep
% layout 'default';

@@ cart/checkout-review.html.ep
% title 'Review Totals';
% layout 'default';

<dl>
    <dt>Cost of products:</dt>
        <dd>$<%= cart->total %></dd>
    <dt><abbr title="Goods and Services Tax">GST</abbr>:</dt>
        <dd>$<%= stash 'tax' %></dd>
    <dt>Shipping charge:</dt>
        <dd>$<%= stash 'shipping' %>
            <small>(includes applicable taxes)</small></dd>
    <dt>Total:</dt>
        <dd>$<%= stash 'total_dollars'
            %><sup>.<%= stash 'total_cents' %></sup></dd>
</dl>


<form action="https://www.paypal.com/ca/cgi-bin/webscr" method="POST"
    id="checkout_paynow_form">
    %= hidden_field 'upload'            => 1
    %= hidden_field 'cmd'               => '_cart'
    %= hidden_field 'custom'            => stash 'custom'
    %= hidden_field 'business'          => xtext('paypal')->{email}
    %= hidden_field 'currency_code'     => xtext 'currency'
    %= hidden_field 'cancel_return'     => xtext('current_site') . 'cart/'
    %= hidden_field 'return'        => xtext('current_site') . 'thank-you'
    %= hidden_field 'tax_cart'          => stash 'tax'
    %= hidden_field 'handling_cart'     => stash 'shipping'
    %= hidden_field 'address_override'  => 1
    %= hidden_field 'country'           => 'CA'; # TODO: allow for others
    %= hidden_field 'address1'          => param('address1')
    %= hidden_field 'address2'          => param('address2')
    %= hidden_field 'city'              => param('city')
    %= hidden_field 'state'             => param('province')
    %= hidden_field 'zip'               => param('zip')
    %= hidden_field 'night_phone_a'     => 1; # TODO: sort phones out
    %= hidden_field 'night_phone_b'     => param('phone')

    % for ( 1 .. @{stash('cart_products')||[]} ) {
        % my $p = stash('cart_products')->[$_-1];
        %= hidden_field 'item_name_'   . $_ => $p->{title}
        %= hidden_field 'item_number_' . $_ => $p->{number}
        %= hidden_field 'amount_'      . $_ => $p->{price}
        %= hidden_field 'quantity_'    . $_ => $p->{quantity}
    % }

    %= submit_button 'Proceed to PayPal to complete this purchase'
</form>


@@ cart/checkout.html.ep
% title 'Enter Your Information';
% layout 'default';

%= form_for '/cart/checkout-review' => (method => 'POST') => begin
    %= csrf_field
    <%== form_checker_error_wrapped %>
    <ul>
        <li>
            <label for="c_name">* First Name:</label
            ><%= text_field 'name' => id => 'c_name' %>
        </li>
        <li>
            <label for="c_lname">* Last Name:</label
            ><%= text_field 'lname' => id => 'c_lname' %>
        </li>
        <li>
            <label for="c_address1">* Address line 1:</label
            ><%= text_field 'address1' => id => 'c_address1' %>
        </li>
        <li>
            <label for="c_address2">Address line 2:</label
            ><%= text_field 'address2' => id => 'c_address2' %>
        </li>
        <li>
            <label for="c_city">* City:</label
            ><%= text_field 'city' => id => 'c_city' %>
        </li>
        <li>
            <label for="c_province">* Province:</label
            ><%= select_field 'province' =>
                    [
                        ['--Please choose one--','none'],
                        ['Alberta',             'AB'],
                        ['British Columbia',    'BC'],
                        ['Manitoba',            'MB'],
                        ['New Brunswick',       'NB'],
                        ['New Foundland',       'NL'],
                        ['Northwest Terriories','NT'],
                        ['Nova Scotia',         'NS'],
                        ['Nunavut',             'NU'],
                        ['Ontario',             'ON'],
                        ['Prince Edward Island','PE'],
                        ['Quebec',              'QC'],
                        ['Saskatchewan',        'SK'],
                        ['Yukon',               'YT'],
                    ]
                => id => 'c_province'
            %>
        </li>
        <li>
            <label for="c_zip">* Postal code:</label
            ><%= text_field 'zip' => id => 'c_zip' %>
        </li>
        <li>
            <label for="c_phone">* Phone number:</label
            ><%= text_field 'phone' => id => 'c_phone' %>
        </li>
        <li>
            <label for="c_promo_code">Promo code:</label
            ><%= text_field 'promo_code' => id => 'c_promo_code' %>
        </li>
        <li>
            <%= check_box do_save_address => 1, id => 'c_do_save_address'
            %><label for="c_do_save_address"> remember my information on this computer <small>(uncheck this later to forget)</small></label>
        </li>
        <li>
            <%= check_box toc => 1, id => 'c_toc'
            %><label for="c_toc">*I have read and agree with <a target="_blank" href="/terms">Terms and Conditions</a> and <a target="_blank" href="/privacy-policy">Privacy Policy</a></label>
        </li>
    </ul>
    %= submit_button 'Calculate taxes and shipping charge'
%= end

@@ cart/index.html.ep
% title 'Your Cart';
% layout 'default';

% if ( @{ stash('products')||[] } ) {

    <p>Here are the items you're purchasing. To remove a product, set quantity to zero.</p>

    %= form_for '/cart/checkout' => (method => 'POST') => begin
        %= csrf_field
        <table>
        <thead>
            <tr>
                <th></th>
                <th>Product</th>
                <th>Price</th>
                <th>Quantity</th>
            </tr>
        </thead>
        <tbody>
            % for ( @{ stash('products') } ) {
                <tr>
                    <td><img src="/product-pics/thumbs-tiny/<%=
                        $_->{image} %>" alt=""></td>
                    <td><a href="/product/<%= $_->{url} %>"
                        ><%= $_->{title} %></a></td>
                    <td>$<%= $_->{price_dollars}
                        %><sup>.<%= $_->{price_cents} %></sup></td>
                    <td>
                        <%= hidden_field 'id_' . $_->{id} => $_->{id} %>
                        <%= hidden_field 'number_' . $_->{id}
                            => $_->{number} %>
                        <%= text_field 'quantity_' . $_->{id}
                            => ( value => $_->{quantity} )
                        %>
                    </td>
                </tr>
            % }
        </tbody>
        </table>
        %= submit_button 'Proceed to the next step'
    %= end
% } else {
    <p class="message error">There are no products in your cart.</p>
% }

@@ cart/add.html.ep
% layout 'default';

<p class="message success">
    Successfully added <%= stash 'quantity' %> of <%= stash 'number' %>
        to the cart.

    <a href="<%= stash 'return_to' %>">Continue shopping.</a>
</p>

@@ product.html.ep
% layout 'default';
% title stash('product')->{title};

<img src="/content-pics/products/<%= stash('product')->{image} %>" alt="">

<p>
    <span class="number">#<%= stash('product')->{number} %></span>
    <span class="price_large">
        <%= stash('product')->{price_dollars}
            %><sup>.<%= stash('product')->{price_cents} %></sup>
        <span class="sku">per <%= stash('product')->{unit} %></span>
    </span>
</p>

%= form_for '/cart/add' => (method => 'POST') => begin
    %= csrf_field
    %= hidden_field number => stash('product')->{number}

    <%= text_field 'quantity' => ( value => 1 ) %>

    %= submit_button 'Add to cart'
%= end

<div>
    <%== stash('product')->{description} %>
</div>

@@ products.html.ep
% layout 'default';
% title xtext 'products_nav_name';

% if ( defined(stash 'return_path') ) {
    <p id="back_up_category">
        % if ( defined(stash 'return_name') ) {
            <a href="/products/<%= stash 'return_path' %>"
                class="link_button">
                Back to <%= stash 'return_name' %>
            </a>
        % } else {
            <a href="/products"
                class="link_button">Back to category list</a>
        % }
    </p>
% }

<ul id="product_list">
% for ( @{ stash('products') } ) {
    <li>
        % if ( $_->{display_product} ) {
        <a href="/product/<%= $_->{url}
            %>"><%= $_->{title} %></a>
        % } else {
            <a href="/products/<%= $_->{cat_url} %>"
                ><%= $_->{title} %></a>
            <ul>
                % for ( @{ $_->{contents} } ) {
                    <li>
                        % if ( $_->{is_subsub_cat} ) {
                            <a href="/products/<%= $_->{cat_url} %>">
                                <%= $_->{title} %>
                            </a>
                        % } else {
                            <a href="/product/<%= $_->{url} %>">
                                <%= $_->{title} %>
                            </a>
                        % }
                    </li>
                % }
            </ul>
        % }
    </li>
% }
</ul>

@@ user/index.html.ep
% layout 'default';
% title 'User Section';

<ul class="link_button_list">
    <li><a href="/user/master-products-database">Master products
        database</a></li>
    <li><a href="/logout">Log out</a></li>
</ul>

@@ user/master-products-database.html.ep
% layout 'default';
% title 'Master Products Database';


% if ( flash 'product_update_ok' ) {
   <p class="message success">Products were successfully updated.</p>
% }

% if ( flash 'product_delete_ok' ) {
   <p class="message success">Products were successfully deleted.</p>
% }

<h3>Add Product</h3>

% if ( stash 'product_add_ok' ) {
    <p class="message succcess">Product was successfully added.
        <a href="<%= url_for 'user/master-products-database' %>">Add
            another one</a>.
    </p>
% } else {
    %= form_for '/user/master-products-database' => (method => 'POST') => begin
        %= csrf_field

        % if ( stash 'already_have_this_product' ) {
            <p class="message error">This product number is already
                in the database. Aborting add.
            </p>
        %}

        <%== form_checker_error_wrapped %>

        %= hidden_field add_product => 1

        <small>Fields marked with an asterisk (*) are mandatory</small>
        <small>Separate multiple images with a question mark (?).
            If not specified, <samp>product_number.jpg</samp> will be used.
        </small>
        <small>
            Category format: <samp>[cat1*::*cat2*::* ... *::*cat_n][cat1*::*cat2*::* ... *::*cat_n][cat3*::*NOCAT]</samp>
        </small>
        <small>Plural units are smart-deduced, but you can override
            by giving plurals with a comma: e.g. <samp>each, eaches</samp>
        </small>

        <ul>
            <li><label for="image">Image:</label
                ><%= text_field 'image' => ( id => 'image' )
            %></li>
            <li><label for="number">Number:</label
                ><%= text_field 'number' => ( id => 'number' )
            %></li>
            <li><label for="price">Price:</label
                ><%= text_field 'price' => ( id => 'price' )
            %></li>
            <li><label for="title">Title:</label
                ><%= text_field 'title' => ( id => 'title' )
            %></li>
            <li><label for="description">Description:</label
                ><%= text_area 'description', cols => 40, rows => 5,
                     => ( id => 'description' )
            %></li>
            <li><label for="tip_description">Tip description:</label
                ><%= text_area 'tip_description', cols => 40, rows => 5,
                     => ( id => 'tip_description' )
            %></li>
            <li><label for="quote_description">Quote description:</label
                ><%= text_area 'quote_description', cols => 40, rows => 3,
                     => ( id => 'quote_description' )
            %></li>
            <li><label for="category">Category:</label
                ><%= text_field 'category' => ( id => 'category' )
            %></li>
            <li><label for="group_master">Group master:</label
                ><%= text_field 'group_master' => ( id => 'group_master' )
            %></li>
            <li><label for="group_desc">Group description:</label
                ><%= text_field 'group_desc' => ( id => 'group_desc' )
            %></li>
            <li><label for="recommended">Recommended products:</label
                ><%= text_area 'recommended', cols => 40, rows => 3,
                     => ( id => 'recommended' )
            %></li>
            <li><label for="unit">Unit:</label
                ><%= text_field 'unit' => ( id => 'unit' )
            %></li>
        </ul>
        %= submit_button 'Add product'
    %= end
% }

% if ( @{stash('products') || []} ) {
    <h3>Delete Products</h3>

    %= form_for '/user/master-products-database/delete' => ( method => 'POST' ) => begin
        %= csrf_field
        <%= text_area 'to_delete' => cols => 40, rows => 3 %>
        %= submit_button 'Delete products'
    %= end

    <h3>Update Products</h3>

    %= form_for '/user/master-products-database/update' => ( method => 'POST' ) => begin

    %= csrf_field

    %= submit_button 'Update products'

    <ul>
        % for my $p ( @{stash('products') || []}) {
            <li>
                %= hidden_field 'id_' . $p->{id} => $p->{id}
                <ul>
                    <li><label for="image">Image:</label
                        ><%= text_field 'image_' . $p->{id} => $p->{image}
                    %></li>
                    <li><label for="number">Number:</label
                        ><%= text_field 'number_' . $p->{id} => $p->{number}
                    %></li>
                    <li><label for="price">Price:</label
                        ><%= text_field 'price_' . $p->{id} => $p->{price}
                    %></li>
                    <li><label for="title">Title:</label
                        ><%= text_field 'title_' . $p->{id} => $p->{title}
                    %></li>
                    <li><label for="description">Description:</label
                        ><%= text_area 'description_' . $p->{id}
                            => $p->{description}, cols => 40, rows => 5,
                    %></li>
                    <li><label for="tip_description">Tip description:</label
                        ><%= text_area 'tip_description_' . $p->{id}
                            => $p->{tip_description}, cols => 40, rows => 5,
                    %></li>
                    <li><label for="quote_description">Quote description:</label
                        ><%= text_area 'quote_description_' . $p->{id}
                            => $p->{quote_description}, cols => 40, rows => 3
                    %></li>
                    <li><label for="category">Category:</label
                        ><%= text_field 'category_' . $p->{id}
                            => $p->{category}
                    %></li>
                    <li><label for="group_master">Group master:</label
                        ><%= text_field 'group_master_' . $p->{id}
                            => $p->{group_master}
                    %></li>
                    <li><label for="group_desc">Group description:</label
                        ><%= text_field 'group_desc_' . $p->{id}
                             => $p->{group_desc}
                    %></li>
                    <li><label for="recommended">Recommended products:</label
                        ><%= text_area 'recommended_' . $p->{id}
                            => $p->{recommended}, cols => 40, rows => 3,
                    %></li>
                    <li><label for="unit">Unit:</label
                        ><%= text_field 'unit_' . $p->{id}  => $p->{unit}
                    %></li>
                </ul>
            </li>
        % }
    </ul>

    %= submit_button 'Update products'

    %= end
% }